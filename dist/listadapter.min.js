HTMLElement="undefiend"!=typeof HTMLElement?HTMLElement:Element,HTMLElement.prototype.prependChild=function(t){return this.firstChild?this.insertBefore(t,this.firstChild):this.appendChild(t)},HTMLDocument.prototype.getHeight=function(){return document.body.clientHeight},HTMLElement.prototype.getHeight=function(){return this.clientHeight},HTMLDocument.prototype.getScrollTop=HTMLElement.prototype.getScrollTop=function(){var t=document.documentElement
return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)},HTMLDocument.prototype.getScrollLeft=HTMLElement.prototype.getScrollLeft=function(){var t=document.documentElement
return(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)},HTMLElement.prototype.addClass=function(t){this.className+=" "+t},HTMLElement.prototype.removeClass=function(t){this.className=this.className.replace(t,"")},HTMLElement.prototype.scrollParent=function(){var t=/(auto|scroll)/,e=function(t,i){return null===t.parentNode?i:e(t.parentNode,i.concat([t]))},i=function(t,e){return getComputedStyle(t,null).getPropertyValue(e)},s=function(t){return i(t,"overflow")+i(t,"overflow-y")+i(t,"overflow-x")},o=function(e){return t.test(s(e))},n=function(){if(this instanceof HTMLElement){for(var t=e(this.parentNode,[]),i=0;i<t.length;i+=1)if(o(t[i]))return t[i]
return document}}
return n}()
var GroupSelector=function(t){this.target=t}
GroupSelector.prototype.attr=function(t,e){this.target.forEach(function(i){i[t]=e})},GroupSelector.prototype.css=function(t,e){this.target.forEach(function(i){i.style[t]=e})},GroupSelector.prototype.className=function(t){this.target.forEach(function(e){e.className=t})}
var ListAdapter=function(t,e){if("string"==typeof t&&(t=document.querySelector(t)),this.containerEl=t,!t||null===t)throw new"List container not specified."
if(e instanceof ListAdapter){this.itemCreateHandler=e.itemCreateHandler,this.itemLoadHandler=e.itemLoadHandler,this.itemTypeResolver=e.itemTypeResolver,this.itemsCount=0,this.offscreenItems=e.offscreenItems,this.itemsPool=e.itemsPool,this.itemHeight=e.itemHeight,this.itemsByType=e.itemsByType,this.itemsY=[],this.isMultiType=e.isMultiType
var i=t.style.display
t.style.display="block",this.offsetTop=t.offsetTop,t.style.display=i,this.itemHtml=e.itemHtml,this.scrollParentEl=this.containerEl.scrollParent(),this.scrollParentEl.addEventListener("scroll",this.postUpdate.bind(this),!1),window.addEventListener("resize",this.postUpdateAndInvalidate.bind(this))}else{if(this.itemCreateHandler=e&&e.onItemCreate||function(){},this.itemLoadHandler=e&&e.onItemLoad||function(){},this.itemTypeResolver=e&&e.getItemType||function(){return 0},this.itemsCount=0,this.offscreenItems=3,0==t.childElementCount)throw new"List container must have at least 1 element as a template."
this.itemsPool={},this.itemsByType={},this.itemsY=[],this.isMultiType=!1
var i=t.style.display
for(t.style.display="block",this.itemHeight=0;t.childElementCount>0;){var s=t.children[0]
s.remove(),document.body.appendChild(s)
var o=s.offsetHeight
0==o&&(o=parseInt(s.style.height)),s.style.position="absolute"
var n=s.attributes["data-item-type"]&&s.attributes["data-item-type"].value||0
this.itemsByType[n]={height:o,html:s.outerHTML},this.itemsPool[n]=new Array,0!=n&&(this.isMultiType=!0),s.remove(),this.itemHeight=Math.max(this.itemHeight,o)}this.offsetTop=t.offsetTop,t.style.display=i,this.scrollParentEl=this.containerEl.scrollParent(),this.scrollParentEl.addEventListener("scroll",this.postUpdate.bind(this),!1),window.addEventListener("resize",this.postUpdateAndInvalidate.bind(this))}}
ListAdapter.prototype.destroy=function(){this.scrollParentEl.removeEventListener("scroll",this.postUpdate.bind(this)),window.removeEventListener("resize",this.postUpdateAndInvalidate.bind(this)),this.itemsPool=void 0,this.items=void 0,this.itemHtml=void 0,this.containerEl=void 0},ListAdapter.prototype.updateItemSize=function(t){for(this.itemHeight=t;this.containerEl.childElementCount>0;)this.recycleItem(this.containerEl.children[0])
this.containerEl.style.height=this.itemsCount*t,this.firstEl=this.lastEl=void 0,this.postUpdateAndInvalidate()},ListAdapter.prototype.postUpdate=function(){this.scrollLock||null==this.containerEl.offsetParent||(this.scrollLock=!0,window.requestAnimationFrame(this.updateItems.bind(this)))},ListAdapter.prototype.postUpdateAndInvalidate=function(){if(!this.scrollLock&&null!=this.containerEl.offsetParent){if(this.scrollLock=!0,void 0!=this.firstEl){var t=this.firstEl.offsetHeight
0==t&&(t=this.firstEl.clientHeight),0==t&&(t=parseInt(this.firstEl.style.height)),t>0&&t!=this.itemHeight&&this.updateItemSize(t)}window.requestAnimationFrame(this.updateAndInvalidate.bind(this))}},ListAdapter.prototype.updateAndInvalidate=function(){this.updateItems(),this.invalidate()},ListAdapter.prototype.inAnimation=function(){var t=this.containerEl,e=this.offsetTop-t.offsetTop
void 0==this._inAnimationStart&&(this._inAnimationStart=(new Date).getTime()),0!=e?window.requestAnimationFrame(function(){this.offsetTop=t.offsetTop
for(var e=0;e<t.childElementCount;e++){var i=t.children[e]
i.style.top=this.offsetTop+i.position*this.itemHeight}setTimeout(this.inAnimation.bind(this),16.5)}.bind(this)):(new Date).getTime()-this._inAnimationStart<200?setTimeout(this.inAnimation.bind(this),20):this._inAnimationStart=void 0},ListAdapter.prototype.setItems=function(t,e){if(void 0==e)if(this.itemsCount=t.length,this.items=t,this.itemsY=new Array,this.isMultiType){for(var i=0,s=0;s<t.length;s++){var o=this.itemTypeResolver(s,t[s])
i+=this.itemsByType[o].height}this.containerEl.style.height=i}else this.containerEl.style.height=this.itemsByType[0].height*t.length
else{e+t.length>this.itemsCount&&(this.itemsCount=e+t.length)
for(var n=0,s=0;s<t.length;s++){this.items[s+e]=t[s]
var o=this.itemTypeResolver(s+e,t[s])
n+=this.itemHeight-this.itemsByType[o].height}this.containerEl.style.height-=n}window.requestAnimationFrame(this.updateItems.bind(this)),window.requestAnimationFrame(this.invalidate.bind(this))},ListAdapter.prototype.setItemsCount=function(t){this.itemsCount=t,this.items=new Array(t),this.containerEl.style.height=this.itemsCount*this.itemHeight,window.requestAnimationFrame(this.updateItems.bind(this)),window.requestAnimationFrame(this.invalidate.bind(this))},ListAdapter.prototype._queryAll=function(t,e){return new GroupSelector(t.querySelectorAll(e))},ListAdapter.prototype.createViewHolder=function(t,e){var i={el:t,itemType:e,q:t.querySelector.bind(t),all:this._queryAll.bind(this,t)}
return t.viewHolder=i,i},ListAdapter.prototype.getItemEl=function(t){var e=this.items[t],i=this.itemTypeResolver(t,e),s=this.itemsPool[i].pop()
if(void 0==s){var o=document.createElement("div")
o.innerHTML=this.itemsByType[i].html,s=this.createViewHolder(o.firstChild,i),this.itemCreateHandler(s,i)}return this.itemLoadHandler(s,t,this.items[t],i),s.el},ListAdapter.prototype.recycleItem=function(t){var e=t.viewHolder
this.itemsPool[e.itemType].push(e),t.remove()},ListAdapter.prototype.getPositionForItem=function(t){if(void 0!=this.itemsY[t])return this.itemsY[t]
if(this.isMultiType)return this.itemsY[t]=t*this.itemHeight
if(0==t)return this.itemsY[t]=0
var e=this.itemTypeResolver(t-1,this.items[t-1])
return this.itemsY[t]=this.getPositionForItem(t-1)+this.itemsByType[e].height},ListAdapter.prototype.getItemForPosition=function(t){for(var e=0;e<this.items.length;e++){var i=this.getPositionForItem(e)
if(i>=t)return e}return-1},ListAdapter.prototype.updateItems=function(){this.scrollLock=!0
var t=this.containerEl,e=this.scrollParentEl
this.itemsByType,this.itemsPool
this.offsetTop=t.offsetTop
for(var i=e.getScrollTop(),s=i-this.offscreenItems*this.itemHeight,o=e.getHeight()+this.offscreenItems*this.itemHeight+i;this.firstEl;){var n=this.firstEl
if(!(n.offsetTop+n.offsetHeight<s))break
this.recycleItem(n),t.childElementCount>0?this.firstEl=t.children[0]:this.firstEl=this.lastEl=!1}for(;this.lastEl;){var r=this.lastEl
if(!(r.offsetTop>o))break
this.recycleItem(r),t.childElementCount>0?this.lastEl=t.children[t.childElementCount-1]:this.firstEl=this.lastEl=!1}if(this.firstEl&&this.firstEl.offsetTop>s){var l=this.firstEl.position-1
if(l>=0){var h=this.getItemEl(l)
h.position=l,h.style.top=this.offsetTop+this.getPositionForItem(l),t.prependChild(h),this.firstEl=h,this.lastEl||(this.lastEl=this.firstEl),window.requestAnimationFrame(this.updateItems.bind(this))}}if(!this.lastEl||this.lastEl.offsetTop+this.lastEl.offsetHeight<o){var l=-1
if(this.lastEl?l=this.lastEl.position+1:this.itemsCount>0&&(l=this.getItemForPosition(i)),l>=0&&l<this.itemsCount){var h=this.getItemEl(l)
h.position=l,h.style.top=this.offsetTop+this.getPositionForItem(l),t.appendChild(h),this.lastEl=h,this.firstEl||(this.firstEl=this.lastEl),window.requestAnimationFrame(this.updateItems.bind(this))}}this.scrollLock=!1},ListAdapter.prototype.invalidate=function(){for(var t=this.containerEl,e=(this.itemHandler,0);e<t.childElementCount;e++){var i=t.children[e],s=i.position
i.style.top=this.offsetTop+this.getPositionForItem(s),this.itemLoadHandler(i.viewHolder,s,this.items[s])}}
